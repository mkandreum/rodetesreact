# SoluciÃ³n Error 403 en Upload

El error 403 al subir archivos indica que la sesiÃ³n de admin no se estÃ¡ manteniendo correctamente.

## Cambios Implementados

### 1. Middleware con Logging (`backend/middleware/auth.ts`)
AÃ±adido logging detallado para debugging:
- Verifica si existe sesiÃ³n
- Muestra sessionID
- Verifica flag isAdmin
- Muestra cookies recibidas

### 2. Login con Session.save() (`backend/routes/auth.ts`)
El problema principal: **no se estaba guardando explÃ­citamente la sesiÃ³n**.

```typescript
req.session.save((err) => {
    if (err) {
        console.error('Session save error:', err);
        return res.status(500).json({ error: 'Session error' });
    }
    res.json({ success: true });
});
```

### 3. ConfiguraciÃ³n de Session ya aplicada
- `sameSite: 'lax'` âœ…
- `httpOnly: true` âœ…
- `secure: true` en producciÃ³n âœ…
- Store PostgreSQL configurado âœ…

## Siguiente Paso

1. **Rebuild y redeploy** para aplicar cambios
2. **Revisar logs** del backend para ver el flujo de autenticaciÃ³n
3. Si persiste el error, verificar que:
   - El login se ejecuta antes de intentar subir
   - Las cookies se estÃ¡n enviando correctamente
   - El proxy/reverse proxy no estÃ¡ bloqueando cookies

## Debugging en ProducciÃ³n

Los logs ahora mostrarÃ¡n:
```
ğŸ”‘ Login attempt: { username: 'admin', hasPassword: true }
âœ… Login success, session saved: [sessionID]
ğŸ” Auth check: { hasSession: true, sessionID: '...', isAdmin: true }
âœ… Auth success
```

Si falla:
```
âŒ Auth failed - not admin
```
Revisar cookies y configuraciÃ³n del proxy.
